<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¯ÙŠØ± | FF Store</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #0f172a; color: white; padding: 20px; }
        .admin-card { background: #1e293b; padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #334155; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border: 1px solid #334155; text-align: center; }
        th { background: #ef4444; }
        .btn-done { background: #10b981; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        .btn-copy { background: #3b82f6; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; margin-right: 5px; }
        input { padding: 8px; border-radius: 5px; border: none; width: 200px; }
    </style>
</head>
<body>

    <h2>ğŸ‘¨â€ğŸ’» Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ¬Ø±</h2>

    <div class="admin-card">
        <h3>ğŸ’° Ø¥Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯ Ù„Ù„Ù…Ø­ÙØ¸Ø©</h3>
        <input type="text" id="targetUID" placeholder="Ø£Ø¯Ø®Ù„ UID Ø§Ù„Ø²Ø¨ÙˆÙ†">
        <input type="number" id="amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº (Ø¬.Ø³)">
        <button class="btn-done" onclick="addBalance()">Ø¥Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯ Ø§Ù„Ø¢Ù†</button>
    </div>

    <div class="admin-card">
        <h3>ğŸ“¥ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø­Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</h3>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ø²Ø¨ÙˆÙ†</th>
                    <th>Ø§Ù„Ø¨Ø§Ù‚Ø©</th>
                    <th>ID Ø§Ù„Ù„Ø§Ø¹Ø¨</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                </tr>
            </thead>
            <tbody id="ordersTable">
                </tbody>
        </table>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, set, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCwb4HhEtQyzdlya4L85WkiA3vA_fW85Wk",
            authDomain: "ffstore-a008a.firebaseapp.com",
            databaseURL: "https://ffstore-a008a-default-rtdb.firebaseio.com/",
            projectId: "ffstore-a008a",
            storageBucket: "ffstore-a008a.firebasestorage.app",
            messagingSenderId: "993784923560",
            appId: "1:993784923560:web:b3933cef1bf4661188099d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ÙˆØ¸ÙŠÙØ© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯
        window.addBalance = () => {
            const uid = document.getElementById('targetUID').value;
            const cash = parseInt(document.getElementById('amount').value);
            if(!uid || !cash) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©");

            const userRef = ref(db, 'users/' + uid);
            onValue(userRef, (s) => {
                const current = s.val() ? s.val().balance : 0;
                update(userRef, { balance: current + cash });
                alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­!");
            }, { onlyOnce: true });
        };

        // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙˆØªØ­Ø¯ÙŠØ«Ù‡Ø§
        onValue(ref(db, 'orders/'), (snapshot) => {
            const table = document.getElementById('ordersTable');
            table.innerHTML = "";
            snapshot.forEach((child) => {
                const order = child.val();
                const row = `<tr>
                    <td>${order.customerName}</td>
                    <td>${order.packageName}</td>
                    <td>
                        <b>${order.playerID}</b>
                        <button class="btn-copy" onclick="navigator.clipboard.writeText('${order.playerID}'); alert('ØªÙ… Ø§Ù„Ù†Ø³Ø®')">Ù†Ø³Ø®</button>
                    </td>
                    <td>${order.status}</td>
                    <td>
                        <button class="btn-done" onclick="completeOrder('${child.key}')">ØªÙ… Ø§Ù„Ø´Ø­Ù† âœ…</button>
                    </td>
                </tr>`;
                table.innerHTML += row;
            });
        });

        window.completeOrder = (orderKey) => {
            update(ref(db, 'orders/' + orderKey), { status: "ØªÙ… Ø§Ù„Ø´Ø­Ù† Ø¨Ù†Ø¬Ø§Ø­ âœ…" });
            // Ø§Ø®ØªÙŠØ§Ø±ÙŠ: ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ø­Ù† Ù„ØªØ¨Ù‚Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù†Ø¸ÙŠÙØ©
            // remove(ref(db, 'orders/' + orderKey)); 
        };
    </script>
</body>
</html>
